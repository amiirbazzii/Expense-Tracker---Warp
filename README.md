# ğŸ’° PWA Expense Tracker App

A mobile-first, installable Progressive Web App (PWA) for tracking daily expenses with offline support.

## ğŸ¯ Features

### âœ… Authentication
- [x] Custom username/password authentication
- [x] User registration and login
- [x] Persistent auth sessions
- [x] Secure logout functionality

### âœ… Expense Management
- [x] Add expenses with amount, title, categories, and date
- [x] Tag-based category system with auto-suggestions
- [x] Multiple categories per expense
- [x] Optional "for" field for expense attribution
- [x] Optimistic updates for better UX

### âœ… Dashboard & Analytics
- [x] Monthly expense summaries
- [x] Month navigation (previous/next)
- [x] Interactive pie chart for category breakdown
- [x] Bar chart for daily spending patterns
- [x] Responsive charts for mobile devices

### âœ… AI Financial Chat
- [x] Natural language queries about finances
- [x] AI-powered insights based on actual transaction data
- [x] Conversation history and context awareness
- [x] Suggested prompts for new users
- [x] Integration with OpenRouter API

### âœ… Offline Support
- [x] IndexedDB for local data caching
- [x] Offline expense creation queue
- [x] Automatic sync when connection restored
- [x] Offline status banner
- [x] Manual sync option

### âœ… Mobile & PWA
- [x] Mobile-first responsive design
- [x] Touch-friendly UI (44px minimum touch targets)
- [x] Installable as native app
- [x] Service worker for offline functionality
- [x] Bottom navigation for mobile
- [x] Framer Motion animations

## ğŸ§± Tech Stack

- **Frontend**: Next.js 14 (App Router), TypeScript, Tailwind CSS
- **Backend**: Convex (database + real-time functions)
- **Auth**: Custom username/password with Convex
- **Charts**: Chart.js with react-chartjs-2
- **Animations**: Framer Motion
- **Offline**: IndexedDB + Service Worker
- **UI**: Lucide React icons, Sonner toasts
- **Forms**: React Hook Form with Zod validation

## ğŸš€ Getting Started

### Prerequisites
- Node.js 18+ 
- npm or yarn

### Installation

1. **Clone the repository**
   ```bash
   git clone <repository-url>
   cd warp-ex-tracker
   ```

2. **Install dependencies**
   ```bash
   npm install
   ```

3. **Set up environment variables**
   
   Create a `.env.local` file in the root directory with the following variables:
   
   ```bash
   # Convex Configuration (generated by npx convex dev)
   CONVEX_DEPLOYMENT=your-deployment-name
   NEXT_PUBLIC_CONVEX_URL=https://your-project.convex.cloud
   
   # OpenRouter API Configuration (required for AI chat feature)
   OPENROUTER_API_KEY=sk-or-v1-your-api-key-here
   OPENROUTER_MODEL=google/gemini-flash-1.5-8b
   ```
   
   **Getting your OpenRouter API Key:**
   1. Sign up at [OpenRouter.ai](https://openrouter.ai/)
   2. Navigate to your API Keys section
   3. Create a new API key
   4. Copy the key (starts with `sk-or-v1-`)
   
   **Available Models:**
   - `google/gemini-flash-1.5-8b` (default, free tier)
   - `openai/gpt-4.1-nano` (free tier)
   - `meta-llama/llama-3.1-8b-instruct:free` (free tier)
   - `mistralai/mistral-7b-instruct:free` (free tier)

4. **Set up Convex**
   ```bash
   npx convex dev
   ```
   This will:
   - Create a new Convex project
   - Update `.env.local` with your Convex URL
   - Set up the database schema
   - Deploy backend functions

5. **Start the development server**
   ```bash
   npm run dev
   ```

6. **Open in your browser**
   Navigate to `http://localhost:3000`

### Building for Production

```bash
npm run build
npm start
```

## ğŸ“± PWA Installation

### On Mobile (iOS/Android)
1. Open the app in Safari (iOS) or Chrome (Android)
2. Tap the share button
3. Select "Add to Home Screen"
4. The app will appear as a native app icon

### On Desktop
1. Open the app in Chrome/Edge
2. Look for the install icon in the address bar
3. Click "Install" to add it as a desktop app

## ğŸŒ Usage

### First Time Setup
1. **Register**: Create an account with username and password
2. **Login**: Sign in to access your expense tracker

### Adding Expenses
1. Navigate to the "Expenses" tab
2. Fill in the expense form:
   - **Amount**: Enter the expense amount
   - **Title**: Brief description (e.g., "Lunch", "Gas")
   - **Categories**: Add tags by typing and pressing Enter
   - **For**: Optional field for attribution
   - **Date**: Select the expense date
3. Tap "Add Expense"

### Viewing Analytics
1. Go to the "Dashboard" tab
2. View monthly summaries with:
   - Total amount spent
   - Number of expenses
   - Category breakdown (pie chart)
   - Daily spending (bar chart)
3. Use arrow buttons to navigate between months

### Using AI Chat
1. Navigate to the "Chat" tab
2. Ask questions about your finances in natural language:
   - "How much did I spend this month?"
   - "What's my biggest expense category?"
   - "Show me my income vs expenses"
3. The AI analyzes your actual transaction data
4. Click suggested prompts to get started
5. Conversation history is saved for context

### Offline Usage
- The app works offline automatically
- Add expenses while offline - they'll be queued
- Orange banner shows offline status
- Expenses sync automatically when back online
- Manual sync available in Settings

### Settings
- View your profile information
- Check connection status
- Manual sync for offline expenses
- Logout option

## âš™ï¸ Environment Variables

The application requires the following environment variables to be configured:

### Required Variables

| Variable | Description | Example | Required For |
|----------|-------------|---------|--------------|
| `CONVEX_DEPLOYMENT` | Convex deployment identifier | `dev:befitting-badger-685` | All features |
| `NEXT_PUBLIC_CONVEX_URL` | Public Convex API endpoint | `https://your-project.convex.cloud` | All features |
| `OPENROUTER_API_KEY` | OpenRouter API authentication key | `sk-or-v1-xxxxx...` | AI Chat |
| `OPENROUTER_MODEL` | AI model to use (optional) | `google/gemini-flash-1.5-8b` | AI Chat |

### Environment Variable Details

#### OPENROUTER_API_KEY
- **Format:** Must start with `sk-or-v1-`
- **Security:** Never expose this key in client-side code or commit to version control
- **Validation:** The backend validates the key format on startup
- **Get yours:** Sign up at [OpenRouter.ai](https://openrouter.ai/)

#### OPENROUTER_MODEL
- **Default:** `google/gemini-flash-1.5-8b` (if not specified)
- **Free tier options:**
  - `google/gemini-flash-1.5-8b` - Fast, large context window
  - `openai/gpt-4.1-nano` - Compact and efficient
  - `meta-llama/llama-3.1-8b-instruct:free` - Open source
  - `mistralai/mistral-7b-instruct:free` - Balanced performance
- **Custom models:** Any model available on OpenRouter can be used

### Setting Up Environment Variables

#### Local Development
1. Create `.env.local` in the project root
2. Add all required variables
3. Never commit this file to git (already in `.gitignore`)

#### Production (Vercel)
1. Go to your Vercel project settings
2. Navigate to "Environment Variables"
3. Add each variable with its value
4. Redeploy to apply changes

#### Production (Other Platforms)
- Ensure all environment variables are set in your hosting platform's configuration
- Variables must be available at build time and runtime
- Use your platform's secrets management for sensitive values

### Troubleshooting

**Error: "OpenRouter API key not configured"**
- Ensure `OPENROUTER_API_KEY` is set in your environment
- Check that the key starts with `sk-or-v1-`
- Verify the key is valid on OpenRouter.ai

**Error: "OpenRouter API key is invalid"**
- The key format is incorrect (must start with `sk-or-v1-`)
- Generate a new key from OpenRouter.ai

**Chat feature not working**
- Verify both `OPENROUTER_API_KEY` and `OPENROUTER_MODEL` are set
- Check Convex logs for detailed error messages
- Ensure you have credits/quota on your OpenRouter account

## ğŸ”§ Development

### Project Structure
```
src/
â”œâ”€â”€ app/                 # Next.js App Router pages
â”‚   â”œâ”€â”€ expenses/        # Main expense form page
â”‚   â”œâ”€â”€ dashboard/       # Analytics dashboard
â”‚   â”œâ”€â”€ settings/        # User settings
â”‚   â”œâ”€â”€ login/          # Authentication
â”‚   â””â”€â”€ register/       # User registration
â”œâ”€â”€ components/         # Reusable components
â”œâ”€â”€ contexts/          # React contexts (Auth, Offline)
â”œâ”€â”€ providers/         # Provider wrappers
convex/               # Backend functions and schema
â”œâ”€â”€ schema.ts         # Database schema
â”œâ”€â”€ auth.ts          # Authentication functions
â””â”€â”€ expenses.ts      # Expense management functions
public/              # Static assets and PWA files
â”œâ”€â”€ manifest.json    # PWA manifest
â”œâ”€â”€ sw.js           # Service worker
â””â”€â”€ *.png           # App icons
```

### Key Components
- `ProtectedRoute`: Authentication wrapper
- `OfflineBanner`: Shows offline status
- `BottomNav`: Mobile navigation
- `AuthContext`: Manages user authentication
- `OfflineContext`: Handles offline functionality

### Database Schema
```typescript
// Users
{
  username: string,
  hashedPassword: string,
  tokenIdentifier: string
}

// Expenses
{
  amount: number,
  title: string,
  category: string[],
  for?: string,
  date: number,
  createdAt: number,
  userId: Id<"users">
}

// Categories
{
  name: string,
  userId: Id<"users">
}
```

## ğŸš€ Deployment

### Vercel (Recommended)
1. Push code to GitHub
2. Connect repository to Vercel
3. Add environment variables in Vercel dashboard:
   - `NEXT_PUBLIC_CONVEX_URL` (from `.env.local`)
   - `OPENROUTER_API_KEY` (your OpenRouter API key)
   - `OPENROUTER_MODEL` (optional, defaults to `google/gemini-flash-1.5-8b`)
4. Deploy automatically

**Important:** Never commit your `.env.local` file to version control. The API keys should only be set in your deployment environment.

### Manual Deployment
1. Build the app: `npm run build`
2. Deploy the `out` folder to any static hosting
3. Ensure environment variables are set

## ğŸ“ˆ Success Criteria

| Feature | Status | Notes |
|---------|--------|-------|
| Auth | âœ… | Register, login, logout all work |
| Expense Input | âœ… | All fields function, tags behave correctly |
| Dashboard | âœ… | Charts reflect monthly data correctly |
| Offline Usage | âœ… | App usable and consistent without internet |
| PWA | âœ… | Installable on Android/iOS via browser |
| Deployment | âœ… | Accessible via Vercel URL |

## ğŸ› Known Issues & Limitations

- Service worker caching is basic (can be enhanced)
- No expense editing/deleting (future feature)
- Simple password hashing (use bcrypt in production)
- Limited to username/password auth (could add OAuth)

## ğŸ”® Future Enhancements

- Profile editing capabilities
- Expense editing and deletion
- Recurring expense tracking
- Search and filtering
- Data export functionality
- Multiple currency support
- Budget tracking and alerts
- Enhanced offline sync with conflict resolution

## ğŸ¤ Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test thoroughly
5. Submit a pull request

## ğŸ“„ License

MIT License - see LICENSE file for details

---

Built with â¤ï¸ using Next.js, Convex, and modern web technologies.
